<Window x:Class="WIMISODriverInjector.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="I.D.I.O.T. - Image Driver Integration &amp; Optimization Tool">
<Grid Background="Transparent">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Sidebar with Acrylic effect -->
        <Border Grid.Column="0"
                x:Name="SidebarBorder"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,0,1,0">
            <Border.Shadow>
                <ThemeShadow />
            </Border.Shadow>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0">
                    <StackPanel Margin="20,20,20,30">
                        <TextBlock Text="I.D.I.O.T."
                                   FontSize="40"
                                   FontWeight="Bold"
                                   Foreground="{ThemeResource PrimaryBrush}"/>
                        <TextBlock Text="Image Driver Integration &amp; Optimization Tool"
                                   FontSize="13"
                                   Foreground="{ThemeResource SecondaryTextBrush}"
                                   TextWrapping="Wrap"
                                   Margin="0,5,0,0"
                                   MaxWidth="210"/>
                    </StackPanel>
                    <StackPanel>
                        <Button x:Name="ImageSelectionButton" Content="1. Image Selection" Click="NavigationButton_Click" Tag="Image"
                                Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                        <Button x:Name="DriverSelectionButton" Content="2. Driver Selection" Click="NavigationButton_Click" Tag="Driver"
                                Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                        <Button x:Name="OptionsButton" Content="3. Options" Click="NavigationButton_Click" Tag="Options"
                                Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Row="2" VerticalAlignment="Bottom" Margin="0,0,0,20">
                    <Button x:Name="CleanupButton" Content="Cleanup" Click="NavigationButton_Click" Tag="Cleanup"
                            Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                    <Button x:Name="LogsButton" Content="Logs" Click="NavigationButton_Click" Tag="Logs"
                            Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                    <Button x:Name="AboutButton" Content="About" Click="NavigationButton_Click" Tag="About"
                            Style="{StaticResource NavigationButtonStyle}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Padding="20,12"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1" Margin="30">
            <ScrollViewer x:Name="MainScrollViewer" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel>
                    <!-- Image Selection Section -->
                    <StackPanel x:Name="ImageSelectionPanel" Visibility="Visible">
                        <TextBlock Text="Image Selection" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <TextBlock Text="Select an ISO or WIM file to process" FontSize="14" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,0,0,30"/>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Scratch Drive" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <ComboBox x:Name="ScratchDriveComboBox" Height="40"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Input File" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="InputFileTextBox" Grid.Column="0" Margin="0,0,10,0" IsReadOnly="True"/>
                                <Button Grid.Column="1" Content="Browse..." Click="BrowseInputFile_Click" Style="{StaticResource ButtonStyle}" Width="100"/>
                            </Grid>
                        </StackPanel>

                        <StackPanel x:Name="ExtractionProgressPanel" Visibility="Collapsed" Margin="0,20,0,0">
                            <TextBlock Text="Extracting ISO file..." FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,10"/>
                            <ProgressBar x:Name="ExtractionProgressBar" Height="25" IsIndeterminate="True"/>
                            <TextBlock x:Name="ExtractionStatusText" Text="Please wait..." FontSize="12" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,10,0,0"/>
                        </StackPanel>

                        <StackPanel x:Name="WimFilesPanel" Visibility="Collapsed" Margin="0,20,0,0">
                            <TextBlock Text="WIM Files Found" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,10"/>
                            <ListView x:Name="WimFilesListBox" Height="150" SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" Margin="5"/>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>

                        <StackPanel x:Name="VersionSelectionPanel" Visibility="Collapsed" Margin="0,20,0,0">
                            <TextBlock Text="OS Version Selection" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,10"/>
                            <TextBlock Text="Select which Windows versions to include in the final image" FontSize="12" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,0,0,10"/>
                            <ItemsControl x:Name="VersionListBox">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Content="{Binding Display}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="5" Foreground="{ThemeResource PrimaryTextBrush}"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <TextBlock Text="Note: All versions in boot.wim will be included automatically" FontSize="11" FontStyle="Italic" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,10,0,0"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Driver Selection Section -->
                    <StackPanel x:Name="DriverSelectionPanel" Visibility="Collapsed">
                        <TextBlock Text="Driver Selection" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <TextBlock Text="Select directories containing driver files (.inf) to inject" FontSize="14" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,0,0,30"/>
                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Driver Directories" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <ListView x:Name="DriverDirectoriesListBox" Height="300" Margin="0,0,0,10" SelectionMode="Single">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}" Margin="5"/>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Add Directory..." Click="AddDriverDirectory_Click" Style="{StaticResource ButtonStyle}" Margin="0,0,10,0"/>
                                <Button Content="Remove Selected" Click="RemoveDriverDirectory_Click" Style="{StaticResource ButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <!-- Options Section -->
                    <StackPanel x:Name="OptionsPanel" Visibility="Collapsed">
                        <TextBlock Text="Options" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Output File" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="OutputFileTextBox" Grid.Column="0" Margin="0,0,10,0"/>
                                <Button Grid.Column="1" Content="Browse..." Click="BrowseOutputFile_Click" Style="{StaticResource ButtonStyle}" Width="100"/>
                            </Grid>
                        </StackPanel>
                        <StackPanel Margin="0,0,0,20">
                            <CheckBox x:Name="OptimizeCheckBox" Content="Optimize and shrink WIM file after injection" IsChecked="True" Margin="0,5" Foreground="{ThemeResource PrimaryTextBrush}"/>
                        </StackPanel>
                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Log File" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="LogFileTextBox" Grid.Column="0" Margin="0,0,10,0" Text="injection-log.txt"/>
                                <Button Grid.Column="1" Content="Browse..." Click="BrowseLogFile_Click" Style="{StaticResource ButtonStyle}" Width="100"/>
                            </Grid>
                        </StackPanel>
                        <StackPanel Margin="0,30,0,0">
                            <TextBlock x:Name="PhaseTextBlock" Text="Progress" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,8"/>
                            <ProgressBar x:Name="ProgressBar" Height="25" Margin="0,0,0,10"/>
                            <TextBlock x:Name="StatusTextBlock" Text="Ready" FontSize="12" Foreground="{ThemeResource SecondaryTextBrush}"/>
                        </StackPanel>
                        <Button x:Name="StartProcessingButton" Content="SQUIRT!" Click="StartProcessing_Click" Style="{StaticResource PrimaryButtonStyle}"
                                FontSize="28" Width="200" Height="70" Margin="0,30,0,0" HorizontalAlignment="Left"/>
                    </StackPanel>

                    <!-- Cleanup Section -->
                    <StackPanel x:Name="CleanupPanel" Visibility="Collapsed">
                        <TextBlock Text="Cleanup" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <TextBlock TextWrapping="Wrap" FontSize="14" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,0,0,24">
                            <Run Text="Sweep Up scans all local drives and the system temp folder for WIMDriverInjector folders, attempts to dismount any WIM mounts inside them, takes ownership, and deletes the contents. If a folder cannot be dismounted, a scheduled task will clean it on the next restart."/>
                        </TextBlock>
                        <StackPanel Margin="0,0,0,16" Visibility="Collapsed" x:Name="SweepUpProgressPanel">
                            <ProgressBar x:Name="SweepUpProgressBar" Height="8" IsIndeterminate="True" Margin="0,0,0,8"/>
                            <TextBlock x:Name="SweepUpStatusText" Text="" FontSize="12" Foreground="{ThemeResource SecondaryTextBrush}" TextWrapping="Wrap"/>
                        </StackPanel>
                        <Button x:Name="SweepUpButton" Content="Sweep Up" Click="SweepUp_Click" Style="{StaticResource PrimaryButtonStyle}" FontSize="28" HorizontalAlignment="Left" HorizontalContentAlignment="Center" Padding="24,12"/>
                    </StackPanel>

                    <!-- About Section -->
                    <StackPanel x:Name="AboutPanel" Visibility="Collapsed">
                        <TextBlock Text="About" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <TextBlock Text="I.D.I.O.T." FontSize="20" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,5"/>
                        <TextBlock Text="Image Driver Integration &amp; Optimization Tool" FontSize="14" Foreground="{ThemeResource SecondaryTextBrush}" Margin="0,0,0,30"/>
                        <TextBlock Text="A portable tool for injecting drivers into Windows installer images." FontSize="14" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                        <TextBlock Text="Features:" FontSize="14" FontWeight="SemiBold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,10"/>
                        <TextBlock Text="• Inject drivers into Windows installer ISO/WIM files&#x0a;• Select specific Windows versions to include&#x0a;• Optimize and shrink WIM files&#x0a;• Modern Windows 11 interface&#x0a;• Portable and self-contained" FontSize="12" Foreground="{ThemeResource PrimaryTextBrush}" Margin="20,0,0,0"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
            <!-- Logs Section: fixed list at top, content below (not inside main scroll) -->
            <Grid x:Name="LogsPanel" Visibility="Collapsed" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="Logs" FontSize="24" FontWeight="Bold" Foreground="{ThemeResource PrimaryTextBrush}" Margin="0,0,0,20"/>
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" MaxHeight="140" Margin="0,0,0,8">
                    <ListView x:Name="LogFilesListBox" SelectionChanged="LogFilesListBox_SelectionChanged" PointerPressed="LogFilesListBox_PointerPressed" SelectionMode="Single">
                        <ListView.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="Copy Text" Click="LogFileCopyText_Click">
                                    <MenuFlyoutItem.Icon>
                                        <SymbolIcon Symbol="Copy"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutItem Text="Show in Explorer" Click="LogFileShowInExplorer_Click">
                                    <MenuFlyoutItem.Icon>
                                        <SymbolIcon Symbol="Folder"/>
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </ListView.ContextFlyout>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Margin="4,2"/>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </ScrollViewer>
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                    <Border Background="#1E1E1E" Padding="8" MinHeight="120">
                        <TextBlock x:Name="LogContentTextBlock" TextWrapping="Wrap" FontFamily="Consolas" FontSize="14" Foreground="#D4D4D4"/>
                    </Border>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>
